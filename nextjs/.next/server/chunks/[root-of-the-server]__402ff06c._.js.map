{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/matt/Projects/codeSandboxes/codr/nextjs/app/api/result/%5BjobId%5D/route.ts"],"sourcesContent":["import { NextRequest } from 'next/server';\n\nconst API_URL = process.env.API_URL;\nconst API_KEY = process.env.API_KEY;\n\n// Error logging utility\nfunction logError(error: any, context: string, requestId?: string) {\n  const errorData = {\n    timestamp: new Date().toISOString(),\n    context,\n    requestId,\n    error: error instanceof Error ? {\n      message: error.message,\n      stack: error.stack,\n      name: error.name\n    } : error\n  };\n\n  console.error('[API_ERROR]', JSON.stringify(errorData, null, 2));\n}\n\nfunction generateRequestId(): string {\n  return `req_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n}\n\nexport async function GET(\n  request: NextRequest,\n  context: { params: Promise<{ jobId: string }> }\n) {\n  const requestId = generateRequestId();\n\n  try {\n    const { jobId } = await context.params;\n\n    // Validate jobId\n    if (!jobId || !/^[a-zA-Z0-9\\-]+$/.test(jobId)) {\n      logError({ invalidJobId: jobId }, 'Job ID validation', requestId);\n\n      // For SSE, we need to send an error event\n      const encoder = new TextEncoder();\n      const stream = new ReadableStream({\n        start(controller) {\n          const errorData = JSON.stringify({ error: 'Invalid job ID' });\n          controller.enqueue(encoder.encode(`data: ${errorData}\\n\\n`));\n          controller.close();\n        }\n      });\n\n      return new Response(stream, {\n        headers: {\n          'Content-Type': 'text/event-stream',\n          'Cache-Control': 'no-cache',\n          'Connection': 'keep-alive',\n        },\n      });\n    }\n\n    // Connect to backend SSE endpoint\n    const backendUrl = `${API_URL}/api/stream/${jobId}`;\n\n    const response = await fetch(backendUrl, {\n      method: 'GET',\n      headers: {\n        'X-API-Key': API_KEY || '',\n        'X-Request-ID': requestId,\n        'Accept': 'text/event-stream',\n      },\n    });\n\n    if (!response.ok) {\n      logError(\n        {\n          status: response.status,\n          statusText: response.statusText,\n          jobId\n        },\n        'SSE connection error',\n        requestId\n      );\n\n      // Send error as SSE event\n      const encoder = new TextEncoder();\n      const stream = new ReadableStream({\n        start(controller) {\n          const errorData = JSON.stringify({\n            error: 'Failed to connect to execution service'\n          });\n          controller.enqueue(encoder.encode(`data: ${errorData}\\n\\n`));\n          controller.close();\n        }\n      });\n\n      return new Response(stream, {\n        headers: {\n          'Content-Type': 'text/event-stream',\n          'Cache-Control': 'no-cache',\n          'Connection': 'keep-alive',\n        },\n      });\n    }\n\n    // Stream the response from backend to client\n    return new Response(response.body, {\n      headers: {\n        'Content-Type': 'text/event-stream',\n        'Cache-Control': 'no-cache',\n        'Connection': 'keep-alive',\n        'X-Accel-Buffering': 'no', // Disable nginx buffering\n      },\n    });\n\n  } catch (error: unknown) {\n    logError(error, 'SSE proxy unhandled exception', requestId);\n\n    // Send error as SSE event\n    const encoder = new TextEncoder();\n    const stream = new ReadableStream({\n      start(controller) {\n        const errorData = JSON.stringify({\n          error: 'Internal server error'\n        });\n        controller.enqueue(encoder.encode(`data: ${errorData}\\n\\n`));\n        controller.close();\n      }\n    });\n\n    return new Response(stream, {\n      headers: {\n        'Content-Type': 'text/event-stream',\n        'Cache-Control': 'no-cache',\n        'Connection': 'keep-alive',\n      },\n    });\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}