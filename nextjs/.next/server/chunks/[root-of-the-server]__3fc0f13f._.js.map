{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 60, "column": 0}, "map": {"version":3,"sources":["file:///Users/matt/Projects/codeSandboxes/codr/nextjs/app/api/code/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\n\n// Keys \nconst API_URL = process.env.API_URL;\nconst API_KEY = process.env.API_KEY;\n\n// Error logging utility\nfunction logError(error: any, context: string, requestId?: string) {\n  const errorData = {\n    timestamp: new Date().toISOString(),\n    context,\n    requestId,\n    error: error instanceof Error ? {\n      message: error.message,\n      stack: error.stack,\n      name: error.name\n    } : error\n  };\n  \n // console.error('[API_ERROR]', JSON.stringify(errorData, null, 2));\n}\n\nfunction generateRequestId(): string {\n  return `req_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n}\n\nexport async function POST(request: NextRequest) {\n  const requestId = generateRequestId();\n  \n  try {\n    // Environment setup\n    if (!API_URL || !API_KEY) {\n      logError(\n        new Error('Environment variables missing or incorrect.'),\n        'Environment validation',\n        requestId\n      );\n      return NextResponse.json(\n        { \n          error: 'Server configuration error',\n          requestId \n        },\n        { status: 500 }\n      );\n    }\n    \n    // Request body\n    let body;\n    try {\n      body = await request.json();\n    } catch (parseError) {\n      logError(parseError, 'Request parsing', requestId);\n      return NextResponse.json(\n        { \n          error: 'Invalid request format',\n          requestId \n        },\n        { status: 400 }\n      );\n    }\n    \n    // Required fields\n    if (!body.code || !body.language || !body.filename) {\n      logError(\n        { missingFields: { code: !body.code, language: !body.language, filename: !body.filename } },\n        'Field validation',\n        requestId\n      );\n      return NextResponse.json(\n        { \n          error: 'Missing required fields',\n          requestId \n        },\n        { status: 400 }\n      );\n    }\n    \n    // Forward the request to API\n    const response = await fetch(`${API_URL}/api/submit`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-API-Key': API_KEY,\n        'X-Request-ID': requestId\n      },\n      body: JSON.stringify(body)\n    });\n    \n    // Handle API response\n    if (!response.ok) {\n      // Get error details for logging\n      const errorText = await response.text();\n      logError(\n        {\n          status: response.status,\n          statusText: response.statusText,\n          responseBody: errorText\n        },\n        'Backend API error',\n        requestId\n      );\n      \n      // Generic errors for client\n      switch (response.status) {\n        case 400:\n          return NextResponse.json(\n            { \n              error: 'Invalid code submission',\n              requestId \n            },\n            { status: 400 }\n          );\n        case 401:\n        case 403:\n          return NextResponse.json(\n            { \n              error: 'Authentication failed',\n              requestId \n            },\n            { status: 403 }\n          );\n        case 429:\n          return NextResponse.json(\n            { \n              error: 'Rate limit exceeded. Please try again later.',\n              requestId \n            },\n            { status: 429 }\n          );\n        default:\n          return NextResponse.json(\n            { \n              error: 'Service temporarily unavailable',\n              requestId \n            },\n            { status: 500 }\n          );\n      }\n    }\n    \n    // Parse successful response\n    const contentType = response.headers.get('content-type');\n    \n    if (contentType && contentType.includes('application/json')) {\n      try {\n        const data = await response.json();\n        return NextResponse.json({\n          ...data,\n          requestId\n        }, { status: response.status });\n      } catch (jsonError) {\n        logError(jsonError, 'Response JSON parsing', requestId);\n        return NextResponse.json(\n          { \n            error: 'Invalid response format',\n            requestId \n          },\n          { status: 500 }\n        );\n      }\n    } else {\n      const text = await response.text();\n      logError(\n        { contentType, response: text },\n        'Unexpected response format',\n        requestId\n      );\n      \n      return NextResponse.json(\n        { \n          error: 'Service error',\n          requestId \n        },\n        { status: 500 }\n      );\n    }\n  } catch (error: unknown) {\n    logError(error, 'Unhandled exception', requestId);\n    \n    return NextResponse.json(\n      { \n        error: 'Internal server error',\n        requestId \n      },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}