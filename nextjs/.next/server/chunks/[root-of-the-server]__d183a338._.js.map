{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///Users/matt/Projects/codeSandboxes/codr/nextjs/app/lib/logging.ts"],"sourcesContent":["/**\n * Logging utilities for API routes\n *\n * Provides centralized error logging with structured data\n */\n\nexport interface ErrorLogData {\n  timestamp: string;\n  context: string;\n  requestId?: string;\n  error: {\n    message: string;\n    stack?: string;\n    name: string;\n  } | any;\n}\n\n/**\n * Log error with structured data\n *\n * @param error - Error object or any value to log\n * @param context - Context description (e.g., 'Request parsing', 'API call')\n * @param requestId - Optional request ID for tracing\n */\nexport function logError(error: any, context: string, requestId?: string): void {\n  const errorData: ErrorLogData = {\n    timestamp: new Date().toISOString(),\n    context,\n    requestId,\n    error: error instanceof Error ? {\n      message: error.message,\n      stack: error.stack,\n      name: error.name\n    } : error\n  };\n\n  // In production, this would send to a logging service like Sentry, CloudWatch, etc.\n  // For now, we log to console (can be enabled/disabled via env var)\n  if (process.env.ENABLE_API_LOGGING === 'true') {\n    console.error('[API_ERROR]', JSON.stringify(errorData, null, 2));\n  }\n}\n\n/**\n * Generate unique request ID for tracing\n *\n * @returns Unique request ID string\n */\nexport function generateRequestId(): string {\n  return `req_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n}\n"],"names":[],"mappings":"AAAA;;;;CAIC;;;;AAoBM,SAAS,SAAS,KAAU,EAAE,OAAe,EAAE,SAAkB;IACtE,MAAM,YAA0B;QAC9B,WAAW,IAAI,OAAO,WAAW;QACjC;QACA;QACA,OAAO,iBAAiB,QAAQ;YAC9B,SAAS,MAAM,OAAO;YACtB,OAAO,MAAM,KAAK;YAClB,MAAM,MAAM,IAAI;QAClB,IAAI;IACN;IAEA,oFAAoF;IACpF,mEAAmE;IACnE,IAAI,QAAQ,GAAG,CAAC,kBAAkB,KAAK,QAAQ;QAC7C,QAAQ,KAAK,CAAC,eAAe,KAAK,SAAS,CAAC,WAAW,MAAM;IAC/D;AACF;AAOO,SAAS;IACd,OAAO,CAAC,IAAI,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,MAAM,CAAC,GAAG,IAAI;AACvE","debugId":null}},
    {"offset": {"line": 86, "column": 0}, "map": {"version":3,"sources":["file:///Users/matt/Projects/codeSandboxes/codr/nextjs/app/api/result/%5BjobId%5D/route.ts"],"sourcesContent":["import { NextRequest } from 'next/server';\nimport { logError, generateRequestId } from '@/app/lib/logging';\n\nconst API_URL = process.env.API_URL;\nconst API_KEY = process.env.API_KEY;\n\nexport async function GET(\n  request: NextRequest,\n  context: { params: Promise<{ jobId: string }> }\n) {\n  const requestId = generateRequestId();\n\n  try {\n    const { jobId } = await context.params;\n\n    // Validate jobId\n    if (!jobId || !/^[a-zA-Z0-9\\-]+$/.test(jobId)) {\n      logError({ invalidJobId: jobId }, 'Job ID validation', requestId);\n\n      // For SSE, we need to send an error event\n      const encoder = new TextEncoder();\n      const stream = new ReadableStream({\n        start(controller) {\n          const errorData = JSON.stringify({ error: 'Invalid job ID' });\n          controller.enqueue(encoder.encode(`data: ${errorData}\\n\\n`));\n          controller.close();\n        }\n      });\n\n      return new Response(stream, {\n        headers: {\n          'Content-Type': 'text/event-stream',\n          'Cache-Control': 'no-cache',\n          'Connection': 'keep-alive',\n        },\n      });\n    }\n\n    // Connect to backend SSE endpoint\n    const backendUrl = `${API_URL}/api/stream/${jobId}`;\n\n    const response = await fetch(backendUrl, {\n      method: 'GET',\n      headers: {\n        'X-API-Key': API_KEY || '',\n        'X-Request-ID': requestId,\n        'Accept': 'text/event-stream',\n      },\n    });\n\n    if (!response.ok) {\n      logError(\n        {\n          status: response.status,\n          statusText: response.statusText,\n          jobId\n        },\n        'SSE connection error',\n        requestId\n      );\n\n      // Send error as SSE event\n      const encoder = new TextEncoder();\n      const stream = new ReadableStream({\n        start(controller) {\n          const errorData = JSON.stringify({\n            error: 'Failed to connect to execution service'\n          });\n          controller.enqueue(encoder.encode(`data: ${errorData}\\n\\n`));\n          controller.close();\n        }\n      });\n\n      return new Response(stream, {\n        headers: {\n          'Content-Type': 'text/event-stream',\n          'Cache-Control': 'no-cache',\n          'Connection': 'keep-alive',\n        },\n      });\n    }\n\n    // Stream the response from backend to client\n    return new Response(response.body, {\n      headers: {\n        'Content-Type': 'text/event-stream',\n        'Cache-Control': 'no-cache',\n        'Connection': 'keep-alive',\n        'X-Accel-Buffering': 'no', // Disable nginx buffering\n      },\n    });\n\n  } catch (error: unknown) {\n    logError(error, 'SSE proxy unhandled exception', requestId);\n\n    // Send error as SSE event\n    const encoder = new TextEncoder();\n    const stream = new ReadableStream({\n      start(controller) {\n        const errorData = JSON.stringify({\n          error: 'Internal server error'\n        });\n        controller.enqueue(encoder.encode(`data: ${errorData}\\n\\n`));\n        controller.close();\n      }\n    });\n\n    return new Response(stream, {\n      headers: {\n        'Content-Type': 'text/event-stream',\n        'Cache-Control': 'no-cache',\n        'Connection': 'keep-alive',\n      },\n    });\n  }\n}\n"],"names":[],"mappings":";;;AACA;;AAEA,MAAM,UAAU,QAAQ,GAAG,CAAC,OAAO;AACnC,MAAM,UAAU,QAAQ,GAAG,CAAC,OAAO;AAE5B,eAAe,IACpB,OAAoB,EACpB,OAA+C;IAE/C,MAAM,YAAY,CAAA,GAAA,uHAAA,CAAA,oBAAiB,AAAD;IAElC,IAAI;QACF,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,QAAQ,MAAM;QAEtC,iBAAiB;QACjB,IAAI,CAAC,SAAS,CAAC,mBAAmB,IAAI,CAAC,QAAQ;YAC7C,CAAA,GAAA,uHAAA,CAAA,WAAQ,AAAD,EAAE;gBAAE,cAAc;YAAM,GAAG,qBAAqB;YAEvD,0CAA0C;YAC1C,MAAM,UAAU,IAAI;YACpB,MAAM,SAAS,IAAI,eAAe;gBAChC,OAAM,UAAU;oBACd,MAAM,YAAY,KAAK,SAAS,CAAC;wBAAE,OAAO;oBAAiB;oBAC3D,WAAW,OAAO,CAAC,QAAQ,MAAM,CAAC,CAAC,MAAM,EAAE,UAAU,IAAI,CAAC;oBAC1D,WAAW,KAAK;gBAClB;YACF;YAEA,OAAO,IAAI,SAAS,QAAQ;gBAC1B,SAAS;oBACP,gBAAgB;oBAChB,iBAAiB;oBACjB,cAAc;gBAChB;YACF;QACF;QAEA,kCAAkC;QAClC,MAAM,aAAa,GAAG,QAAQ,YAAY,EAAE,OAAO;QAEnD,MAAM,WAAW,MAAM,MAAM,YAAY;YACvC,QAAQ;YACR,SAAS;gBACP,aAAa,WAAW;gBACxB,gBAAgB;gBAChB,UAAU;YACZ;QACF;QAEA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,CAAA,GAAA,uHAAA,CAAA,WAAQ,AAAD,EACL;gBACE,QAAQ,SAAS,MAAM;gBACvB,YAAY,SAAS,UAAU;gBAC/B;YACF,GACA,wBACA;YAGF,0BAA0B;YAC1B,MAAM,UAAU,IAAI;YACpB,MAAM,SAAS,IAAI,eAAe;gBAChC,OAAM,UAAU;oBACd,MAAM,YAAY,KAAK,SAAS,CAAC;wBAC/B,OAAO;oBACT;oBACA,WAAW,OAAO,CAAC,QAAQ,MAAM,CAAC,CAAC,MAAM,EAAE,UAAU,IAAI,CAAC;oBAC1D,WAAW,KAAK;gBAClB;YACF;YAEA,OAAO,IAAI,SAAS,QAAQ;gBAC1B,SAAS;oBACP,gBAAgB;oBAChB,iBAAiB;oBACjB,cAAc;gBAChB;YACF;QACF;QAEA,6CAA6C;QAC7C,OAAO,IAAI,SAAS,SAAS,IAAI,EAAE;YACjC,SAAS;gBACP,gBAAgB;gBAChB,iBAAiB;gBACjB,cAAc;gBACd,qBAAqB;YACvB;QACF;IAEF,EAAE,OAAO,OAAgB;QACvB,CAAA,GAAA,uHAAA,CAAA,WAAQ,AAAD,EAAE,OAAO,iCAAiC;QAEjD,0BAA0B;QAC1B,MAAM,UAAU,IAAI;QACpB,MAAM,SAAS,IAAI,eAAe;YAChC,OAAM,UAAU;gBACd,MAAM,YAAY,KAAK,SAAS,CAAC;oBAC/B,OAAO;gBACT;gBACA,WAAW,OAAO,CAAC,QAAQ,MAAM,CAAC,CAAC,MAAM,EAAE,UAAU,IAAI,CAAC;gBAC1D,WAAW,KAAK;YAClB;QACF;QAEA,OAAO,IAAI,SAAS,QAAQ;YAC1B,SAAS;gBACP,gBAAgB;gBAChB,iBAAiB;gBACjB,cAAc;YAChB;QACF;IACF;AACF","debugId":null}}]
}