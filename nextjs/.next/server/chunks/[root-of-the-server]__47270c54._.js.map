{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 60, "column": 0}, "map": {"version":3,"sources":["file:///Users/matt/Projects/codeSandboxes/codr/nextjs/app/lib/logging.ts"],"sourcesContent":["/**\n * Logging utilities for API routes\n *\n * Provides centralized error logging with structured data\n */\n\nexport interface ErrorLogData {\n  timestamp: string;\n  context: string;\n  requestId?: string;\n  error: {\n    message: string;\n    stack?: string;\n    name: string;\n  } | any;\n}\n\n/**\n * Log error with structured data\n *\n * @param error - Error object or any value to log\n * @param context - Context description (e.g., 'Request parsing', 'API call')\n * @param requestId - Optional request ID for tracing\n */\nexport function logError(error: any, context: string, requestId?: string): void {\n  const errorData: ErrorLogData = {\n    timestamp: new Date().toISOString(),\n    context,\n    requestId,\n    error: error instanceof Error ? {\n      message: error.message,\n      stack: error.stack,\n      name: error.name\n    } : error\n  };\n\n  // In production, this would send to a logging service like Sentry, CloudWatch, etc.\n  // For now, we log to console (can be enabled/disabled via env var)\n  if (process.env.ENABLE_API_LOGGING === 'true') {\n    console.error('[API_ERROR]', JSON.stringify(errorData, null, 2));\n  }\n}\n\n/**\n * Generate unique request ID for tracing\n *\n * @returns Unique request ID string\n */\nexport function generateRequestId(): string {\n  return `req_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n}\n"],"names":[],"mappings":"AAAA;;;;CAIC;;;;AAoBM,SAAS,SAAS,KAAU,EAAE,OAAe,EAAE,SAAkB;IACtE,MAAM,YAA0B;QAC9B,WAAW,IAAI,OAAO,WAAW;QACjC;QACA;QACA,OAAO,iBAAiB,QAAQ;YAC9B,SAAS,MAAM,OAAO;YACtB,OAAO,MAAM,KAAK;YAClB,MAAM,MAAM,IAAI;QAClB,IAAI;IACN;IAEA,oFAAoF;IACpF,mEAAmE;IACnE,IAAI,QAAQ,GAAG,CAAC,kBAAkB,KAAK,QAAQ;QAC7C,QAAQ,KAAK,CAAC,eAAe,KAAK,SAAS,CAAC,WAAW,MAAM;IAC/D;AACF;AAOO,SAAS;IACd,OAAO,CAAC,IAAI,EAAE,KAAK,GAAG,GAAG,CAAC,EAAE,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,MAAM,CAAC,GAAG,IAAI;AACvE","debugId":null}},
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///Users/matt/Projects/codeSandboxes/codr/nextjs/app/api/code/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport { logError, generateRequestId } from '@/app/lib/logging';\n\n// Keys\nconst API_URL = process.env.API_URL;\nconst API_KEY = process.env.API_KEY;\nconst ALLOWED_ORIGINS = process.env.ALLOWED_ORIGINS?.split(',') || [];\n\n// CSRF Protection\nfunction validateCSRF(request: NextRequest): { valid: boolean; error?: string } {\n  // Check for custom header to prevent simple form submissions\n  const customHeader = request.headers.get('x-requested-with');\n  if (customHeader !== 'XMLHttpRequest' && customHeader !== 'fetch') {\n    return { valid: false, error: 'Missing required security header' };\n  }\n\n  // Validate origin in production\n  if (process.env.NODE_ENV === 'production' && ALLOWED_ORIGINS.length > 0) {\n    const origin = request.headers.get('origin');\n    const referer = request.headers.get('referer');\n\n    const requestOrigin = origin || (referer ? new URL(referer).origin : null);\n\n    if (!requestOrigin || !ALLOWED_ORIGINS.includes(requestOrigin)) {\n      return { valid: false, error: 'Invalid request origin' };\n    }\n  }\n\n  return { valid: true };\n}\n\nexport async function POST(request: NextRequest) {\n  const requestId = generateRequestId();\n\n  try {\n    // CSRF Protection\n    const csrfCheck = validateCSRF(request);\n    if (!csrfCheck.valid) {\n      logError(\n        new Error(csrfCheck.error),\n        'CSRF validation',\n        requestId\n      );\n      return NextResponse.json(\n        {\n          error: 'Security validation failed',\n          requestId\n        },\n        { status: 403 }\n      );\n    }\n\n    // Environment setup\n    if (!API_URL || !API_KEY) {\n      logError(\n        new Error('Environment variables missing or incorrect.'),\n        'Environment validation',\n        requestId\n      );\n      return NextResponse.json(\n        { \n          error: 'Server configuration error',\n          requestId \n        },\n        { status: 500 }\n      );\n    }\n    \n    // Request body\n    let body;\n    try {\n      body = await request.json();\n    } catch (parseError) {\n      logError(parseError, 'Request parsing', requestId);\n      return NextResponse.json(\n        { \n          error: 'Invalid request format',\n          requestId \n        },\n        { status: 400 }\n      );\n    }\n    \n    // Required fields\n    if (!body.code || !body.language || !body.filename) {\n      logError(\n        { missingFields: { code: !body.code, language: !body.language, filename: !body.filename } },\n        'Field validation',\n        requestId\n      );\n      return NextResponse.json(\n        { \n          error: 'Missing required fields',\n          requestId \n        },\n        { status: 400 }\n      );\n    }\n    \n    // Forward the request to API\n    const response = await fetch(`${API_URL}/api/submit_code`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-API-Key': API_KEY,\n        'X-Request-ID': requestId\n      },\n      body: JSON.stringify(body)\n    });\n    \n    // Handle API response\n    if (!response.ok) {\n      // Get error details for logging\n      const errorText = await response.text();\n      logError(\n        {\n          status: response.status,\n          statusText: response.statusText,\n          responseBody: errorText\n        },\n        'Backend API error',\n        requestId\n      );\n      \n      // Generic errors for client\n      switch (response.status) {\n        case 400:\n          return NextResponse.json(\n            { \n              error: 'Invalid code submission',\n              requestId \n            },\n            { status: 400 }\n          );\n        case 401:\n        case 403:\n          return NextResponse.json(\n            { \n              error: 'Authentication failed',\n              requestId \n            },\n            { status: 403 }\n          );\n        case 429:\n          return NextResponse.json(\n            { \n              error: 'Rate limit exceeded. Please try again later.',\n              requestId \n            },\n            { status: 429 }\n          );\n        default:\n          return NextResponse.json(\n            { \n              error: 'Service temporarily unavailable',\n              requestId \n            },\n            { status: 500 }\n          );\n      }\n    }\n    \n    // Parse successful response\n    const contentType = response.headers.get('content-type');\n    \n    if (contentType && contentType.includes('application/json')) {\n      try {\n        const data = await response.json();\n        return NextResponse.json({\n          ...data,\n          requestId\n        }, { status: response.status });\n      } catch (jsonError) {\n        logError(jsonError, 'Response JSON parsing', requestId);\n        return NextResponse.json(\n          { \n            error: 'Invalid response format',\n            requestId \n          },\n          { status: 500 }\n        );\n      }\n    } else {\n      const text = await response.text();\n      logError(\n        { contentType, response: text },\n        'Unexpected response format',\n        requestId\n      );\n      \n      return NextResponse.json(\n        { \n          error: 'Service error',\n          requestId \n        },\n        { status: 500 }\n      );\n    }\n  } catch (error: unknown) {\n    logError(error, 'Unhandled exception', requestId);\n    \n    return NextResponse.json(\n      { \n        error: 'Internal server error',\n        requestId \n      },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}